{%- comment -%}
  Lazy loading image snippet for performance optimization
  Usage: {% render 'lazy-image', image: product.featured_image, alt: product.title, width: 400, height: 400 %}
{%- endcomment -%}

{%- liquid
  assign image_width = width | default: 400
  assign image_height = height | default: 400
  assign image_alt = alt | default: ''
  assign image_class = class | default: ''
  assign image_loading = loading | default: 'lazy'
  assign image_fetchpriority = fetchpriority | default: 'auto'
  assign image_sizes = sizes | default: '(max-width: 750px) 100vw, (max-width: 990px) 50vw, 33vw'
-%}

{%- if image -%}
  <img
    class="{{ image_class }}"
    src="{{ image | image_url: width: 50 }}"
    data-src="{{ image | image_url: width: image_width }}"
    data-srcset="
      {{ image | image_url: width: 200 }} 200w,
      {{ image | image_url: width: 400 }} 400w,
      {{ image | image_url: width: 600 }} 600w,
      {{ image | image_url: width: 800 }} 800w,
      {{ image | image_url: width: 1000 }} 1000w
    "
    sizes="{{ image_sizes }}"
    alt="{{ image_alt | escape }}"
    width="{{ image_width }}"
    height="{{ image_height }}"
    loading="{{ image_loading }}"
    fetchpriority="{{ image_fetchpriority }}"
    onload="this.src=this.dataset.src;this.srcset=this.dataset.srcset;this.onload=null"
  >
{%- else -%}
  <div class="placeholder-image {{ image_class }}" style="width: {{ image_width }}px; height: {{ image_height }}px; background-color: #f0f0f0; display: flex; align-items: center; justify-content: center;">
    <span>No image</span>
  </div>
{%- endif -%}
